\section{Reconocimiento facial invariante a la edad}

\subsection{Objetivos}
\begin{frame}{Objetivos}

	\begin{itemize}
		\item Resolver una tarea de \textbf{reconocimiento facial invariante a cambios en la edad}, por sus siglas en inglés, \textit{AIFR}.
		\item Estudiar dos variantes \textit{online} en la función de pérdida \textit{Triplet Loss}.
	\end{itemize}

\end{frame}

\subsection{Tarea a resolver}

\begin{frame}{\textit{AIFR}}

	\begin{figure}
		\includegraphics[width=0.8\textwidth]{informatica/ejemplo_dificultad_aifr}
		\caption{Ejemplo de datos con los que trabajamos en una tarea de \textit{AIFR}. Imagen extraída de \cite{informatica:aifr_survey}.}
		\label{img:ejemplo_dificultad_aifr}
	\end{figure}

\end{frame}

\begin{frame}{Problemas asociados a la tarea}

	\begin{itemize}
		\item Pueden ser más similares dos personas distintas de la misma edad que la misma persona en dos edades muy distantes.
		\item El envejecimiento modifica las características faciales.
		\item Trabajar con identidades nunca vistas.
		\item Escasez de conjuntos de datos para estudiar la tarea de \textit{AIFR}, que además presentan diversas dificultades.
	\end{itemize}

\end{frame}

\begin{frame}{Tarea concreta a resolver}

	Tarea de \textbf{verificación}:

	\begin{figure}[!h]
		\includegraphics[width=0.7\textwidth]{informatica/ejemplos_tareas/verification}
		\caption{Imágenes extraídas de \cite{informatica:cacd_dataset}.}
	\end{figure}


\end{frame}

\begin{frame}{\textit{AIFR}}

	Tarea de \textbf{\textit{retrieval}} o búsqueda:

	\begin{figure}[!h]
		\includegraphics[width=0.8\textwidth]{informatica/ejemplos_tareas/retrieval}
		\caption{Imágenes extraídas de \cite{informatica:cacd_dataset}.}
	\end{figure}

	Esta es la tarea en la que centramos nuestro estudio.

\end{frame}

\subsection{Enfoque}
\begin{frame}{Embedding semántico}

	\begin{itemize}
		\item Queremos que nuestra red aprenda un \textbf{\textit{embedding} semántico}.
		\item Elementos de la misma identidad deberán estar cerca entre sí, mientras que elementos de distintas identidades deberán estar distantes.
	\end{itemize}

\end{frame}

\begin{frame}{Embedding semántico}

	\begin{figure}
		\includegraphics[width=0.6\textwidth]{informatica/embedding_paper_principal}
		\caption{Imagen extraída de \cite{informatica:principal}}
	\end{figure}

\end{frame}

\begin{frame}{Redes siamesas}

	\begin{figure}
		\includegraphics[width=0.9\textwidth]{informatica/siamesa_firma}
		\caption{Imagen extraída de \cite{informatica:siamesa_web_imagen}.}
		\label{img:siamesa_firma}
	\end{figure}

	\begin{itemize}
		\item Herramienta para aprender el \textit{embedding}.
		\item Se utiliza o \textit{contrastive loss} (pares) o \textit{triplet loss} (triples).
	\end{itemize}

\end{frame}

\begin{frame}{Triplet Loss}
	\begin{figure}
		\includegraphics[width=1.0\textwidth]{informatica/triplet_loss_learning}
		\caption{Imágenes extraídas de \cite{informatica:cacd_dataset}.}
	\end{figure}

	A partir de:
	\begin{equation}
		D_{A, P} \leq D_{A, N},
	\end{equation}

	llegamos a:

	\begin{equation} \label{ieq:triplet_loss_single_entry}
		\mathcal{L}_{tri}(\theta; A, P, N) := max \{D_{A, P} - D_{A, N} + \alpha, 0 \}
	\end{equation}
\end{frame}

\begin{frame}{Variantes \textit{online} sobre \textit{Triplet Loss}}

	\begin{itemize}
		\item Problema: necesitamos generar los triples de forma \textit{offline}.
		\item Solución: generar los \textit{batches} de forma \textit{online}.
		      \begin{itemize}
			      \item Usando \textit{P-K} sampling.
			      \item Aplicando las variantes \textit{Batch All} y \textit{Batch Hard} sobre estos nuevos \textit{batches}
		      \end{itemize}
	\end{itemize}

\end{frame}

\begin{frame}{\textit{P-K} sampling}

	\begin{figure}
		\includegraphics[width=0.6\textwidth]{informatica/ejemplo_grafico_pk_sampling}
		\caption{Imagen extraída de \cite{informatica:paper_image_pk_sampling}.}
	\end{figure}

	\begin{itemize}
		\item Elegimos $P$ clases aleatorias.
		\item Por cada clase, elegimos $K$ imágenes aleatorias.
	\end{itemize}

\end{frame}

\begin{frame}{Variantes \textit{online}}

	Sobre el anterior \textit{P-K} sampling:

	\begin{itemize}
		\item \textit{Batch All}: probar todas las combinaciones ancla - positivo - negativo.
		\item \textit{Batch Hard}: por cada ancla, computar la pérdida con el positivo más lejano y el negativo más cercano (combinación más complicada).
	\end{itemize}

\end{frame}

\subsection{Experimentación preliminar}
\begin{frame}{\textit{CACD}}

	\begin{figure}
		\includegraphics[width=0.8\textwidth]{informatica/cacd_example}
		\caption{Imagen extraída de \cite{informatica:paper_cacd}}
		\label{img:cacd_imagenes_ejemplo}
	\end{figure}

\end{frame}

\begin{frame}{Resultados preliminares sobre \textit{CACD}}
	\begin{figure}
		\includegraphics[width=1.0\textwidth]{informatica/wandb/entrenamiento_principal/running_loss}
		\caption{Error durante el entrenamiento}
	\end{figure}
\end{frame}
\begin{frame}
	\begin{figure}
		\includegraphics[width=1.0\textwidth]{informatica/wandb/entrenamiento_principal/intracluster_distance}
		\caption{Distanca \textit{intracluster} media}
	\end{figure}
\end{frame}

\begin{frame}{Resultados preliminares sobre \textit{CACD}}
	\begin{figure}
		\includegraphics[width=1.0\textwidth]{informatica/wandb/entrenamiento_principal/intercluster_distance}
		\caption{Distancia \textit{intercluster} media}
	\end{figure}

\end{frame}

\begin{frame}{Resultados preliminares sobre \textit{CACD}}
	\begin{table}
		\centering
		\begin{tabular}{|l|l|l|l|}
			\hline
			Conjunto      & \textit{Rank@1 Accuracy} & \textit{Rank@5 Accuracy} & \textit{Silhouette} \\
			\hline

			Entrenamiento & 0.07185                  & 0.15244                  & -0.41858            \\
			Test          & 0.01000                  & 0.00100                  & -0.32984            \\
			\hline
		\end{tabular}
		\caption{Valores de distintas métricas obtenidas sobre el conjunto \textit{CACD} de entrenamiento y sobre el conjunto \textit{FG-Net} de \textit{test}.}
		\label{table:resultados_sobre_fg_net}
	\end{table}

\end{frame}

\begin{frame}{Resultados preliminares sobre \textit{MNIST}}

	\begin{table}
		\centering
		\begin{tabular}{|l|l|l|l|}
			\hline
			Conjunto      & \textit{Rank@1 Accuracy} & \textit{Rank@5 Accuracy} & \textit{Silhouette} \\
			\hline

			Entrenamiento & 0.0937                   & 0.453                    & 0.000               \\
			Test          & 0.085                    & 0.414                    & 0.000               \\


			\hline
		\end{tabular}
		\caption{Métricas de evaluación obtenidas tras entrenar el modelo sobre \textit{MNIST}.}
		\label{table:resultados_mnist_mal}
	\end{table}

\end{frame}


\begin{frame}{Resultados de terceros}

	\begin{table}[!hbtp]
		\centering
		\begin{tabular}{|l|l|l|l|}
			\hline
			Conjunto      & \textit{Rank@1 Accuracy} & \textit{Rank@5 Accuracy} & \textit{Silhouette} \\
			\hline

			Entrenamiento & 0.916                    & 0.980                    & 0.648               \\
			Test          & 0.940                    & 0.976                    & 0.632               \\

			\hline
		\end{tabular}
		\caption{Métricas de evaluación obtenidas tras entrenar el modelo sobre \textit{MNIST}, usando \textit{Batch SemiHard}, usando la base de código \cite{informatica:adambielski_github}.}
		\label{table:resultados_adam_mnist_random}
	\end{table}

\end{frame}

\subsection{Solución original}
\begin{frame}{Raíz del problema}
\end{frame}


\begin{frame}{Solución original}
\end{frame}

\subsection{Validación experimental de nuestra solución}
\begin{frame}{Resultados en \textit{MNIST} con nuestra solución}

	\begin{figure}
		\includegraphics[width=0.8\linewidth]{informatica/wandb/mnist_corregido/batch_hard_running_loss.png}
		\caption{Función de pérdida.}
	\end{figure}
\end{frame}

\begin{frame}{Resultados en \textit{MNIST} con nuestra solución}

	\begin{figure}
		\includegraphics[width=0.8\linewidth]{informatica/wandb/mnist_corregido/batch_hard_intracluster.png}
		\caption{Distancias intracluster.}
	\end{figure}

\end{frame}

\begin{frame}{Resultados en \textit{MNIST} con nuestra solución}


	\begin{figure}
		\includegraphics[width=0.8\linewidth]{informatica/wandb/mnist_corregido/batch_hard_interclusater.png}
		\caption{Distancias intercluster.}
	\end{figure}


\end{frame}

\begin{frame}{Mejora de los resultados en \textit{MNIST}}


	\begin{table}
		\centering
		\begin{tabular}{|l|l|l|l|l|}
			\hline
			Métrica                  & Conjunto      & Antes  & Después & Mejora   \\
			\hline
			\textit{Rank@1 Accuracy} & Entrenamiento & 0.0937 & 0.997   & 10.64    \\
			\textit{Rank@1 Accuracy} & Test          & 0.085  & 0.992   & 11.67    \\
			\textit{Rank@5 Accuracy} & Entrenamiento & 0.453  & 0.997   & 2.20     \\
			\textit{Rank@5 Accuracy} & Test          & 0.414  & 0.991   & 2.39     \\
			\textit{Silhouette}      & Entrenamiento & 0.000  & 0.953   & $\infty$ \\
			\textit{Silhouette}      & Test          & 0.000  & 0.922   & $\infty$ \\
			\hline
		\end{tabular}
		\label{table:comparaciones_mnist_resultados}
	\end{table}
\end{frame}

\begin{frame}{Mejora de los resultados en \textit{CACD}}

	\begin{table}
		\centering
		\begin{tabular}{|l|l|l|l|l|}
			\hline
			Métrica                  & Conjunto      & Antes   & Después & Mejora \\
			\hline
			\textit{Rank@1 Accuracy} & Entrenamiento & 0.0092  & 0.2676  & 29.09  \\
			\textit{Rank@1 Accuracy} & Test          & 0.0312  & 0.3732  & 11.96  \\
			\textit{Rank@5 Accuracy} & Entrenamiento & 0.0136  & 0.4639  & 34.11  \\
			\textit{Rank@5 Accuracy} & Test          & 0.0781  & 0.6152  & 7.88   \\
			\textit{Silhouette}      & Entrenamiento & -0.1366 & -0.1648 & -0.02  \\
			\textit{Silhouette}      & Test          & -0.1596 & -0.1832 & -0.023 \\
			\hline
		\end{tabular}
		\label{table:comparaciones_cacd_resultados}
	\end{table}


\end{frame}

\subsection{Conclusiones}
\begin{frame}

\end{frame}
